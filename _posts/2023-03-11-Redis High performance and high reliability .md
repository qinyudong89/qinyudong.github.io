---
title: "如何实现 Redis 高性能、 高可靠？"
date: 2023-03-11T08:20:30-04:00
categories:
  - blog
tags:
  - Redis
---
## 高可靠



#### 持久化机制

假设我们的 Redis 是单机部署，那么当这台 Redis 实例出现故障宕机了。由于 Redis 只把数据存储在内存中，那么此时无疑会造成数据丢失。

如果，我们不能容忍数据丢失，那么我们该如何处理呢？

这就需要 Redis 具有持久化数据的能力。具体来说，就是可以把内存中的数据持久化到磁盘。当 Redis 宕机时，我们可以从磁盘中恢复数据。而 Redis 提供了两种持久化方式：RDB 和 AOF，分别对应数据快照和实时的命令持久化，它们相互补充就实现了Redis 的持久化功能。

#### 主从复制机制

前面 Redis 提供持久化机制，已经让我们不用担心数据丢失问题。但是，如果 Redis 宕机后再从磁盘恢复数据也是时间。

有没有好的办法缩短数据恢复时间呢？

针对这个问题，解决方案就是：采用多个副本。我们需要 Redis 可以实时保持多个副本的同步，也就是我们说的主从复制。这样，当一个实例宕机时，我们还有其他完整的副本可以使用。这时，只需要把一个副本提升为主节点，继续提供服务就可以了，这就避免了数据恢复过程中的一些影响。

#### 哨兵

主从复制机制可以缩短数据恢复时间，减少影响。但还是需要人工干预，那么必然无法做到实时。

那么，要实现主从自动切换，就需要能够保证高可用的组件：哨兵。哨兵可以实时检测主节点的健康情况。当主节点故障时，它会立即把一个从节点提升上来，实现自动故障转移，整个过程无需人工干预，程序自动完成，大大地减少了故障带来的影响。



#### 切片集群

我们说的都是针对单个 Redis 实例的功能。如果我们业务的读写请求不大，使用单个实例没有问题，但是当业务写入量很大时，单个Redis 实例就无法承担这么大的写入量了。

这个时候，我们就需要引入：切片集群了，也就是把多个Redis 实例组织起来，形成一个集群，对外提供服务。同时，这个集群还要具有水平扩展的能力，当业务量再增长时，可以通过增加机器部署新实例的方法，承担更大的请求量，这样一来，我们的集群性能也可以变得很高。

所以，就有了 Redis Cluster、Twemproxy、Codis 这些集群解决方案。其中，Redis Cluster是官方提供的集群方案，而 Twemproxy 和Codis 是早期 Redis Cluster不够完善时而开发出来的。

既然是多个节点存储数据，而且还要在节点不足时能够增加新的节点扩容集群，这也对应着切片集群的核心问题：数据路由 和 数据迁移。

数据路由用于解决把数据写到哪个节点的问题，而数据迁移用于解决在节点发生变更时，集群数据重新分布的问题。



## 高性能

Redis的数据都存储在内存中，再加上使用IO多路复用机制，所以，Redis的性能非常高。如果配合切片集群的使用，性能就会再上一个台阶。



## 参考

本文摘抄至 Kaito 的 [我是如何学习Redis的？高效学习Redis的路径和方法分享](o.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/config/principle/